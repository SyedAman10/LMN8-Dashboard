{"version":3,"sources":["turbopack:///[project]/src/lib/auth.js","turbopack:///[project]/node_modules/dotenv/lib/main.js","turbopack:///[project]/src/lib/patientAuth.js","turbopack:///[project]/src/app/api/patients/route.js","turbopack:///[project]/node_modules/next/dist/esm/build/templates/app-route.js"],"sourcesContent":["import bcrypt from 'bcryptjs';\nimport { query } from './db.js';\n\n// Hash password\nexport async function hashPassword(password) {\n  const saltRounds = 12;\n  return await bcrypt.hash(password, saltRounds);\n}\n\n// Verify password\nexport async function verifyPassword(password, hashedPassword) {\n  return await bcrypt.compare(password, hashedPassword);\n}\n\n// Generate a simple session token (in production, use a proper JWT library)\nexport function generateSessionToken() {\n  return Math.random().toString(36).substring(2) + Date.now().toString(36);\n}\n\n// Create user session\nexport async function createUserSession(userId) {\n  const sessionToken = generateSessionToken();\n  const expiresAt = new Date();\n  expiresAt.setDate(expiresAt.getDate() + 7); // 7 days from now\n\n  await query(\n    'INSERT INTO user_sessions (user_id, session_token, expires_at) VALUES ($1, $2, $3)',\n    [userId, sessionToken, expiresAt]\n  );\n\n  return sessionToken;\n}\n\n// Get user by session token\nexport async function getUserBySession(sessionToken) {\n  const result = await query(\n    `SELECT u.*, s.expires_at \n     FROM users u \n     JOIN user_sessions s ON u.id = s.user_id \n     WHERE s.session_token = $1 AND s.expires_at > NOW() AND u.is_active = true`,\n    [sessionToken]\n  );\n\n  return result.rows[0] || null;\n}\n\n// Clean up expired sessions\nexport async function cleanupExpiredSessions() {\n  await query('DELETE FROM user_sessions WHERE expires_at < NOW()');\n}\n\n// Get user by email\nexport async function getUserByEmail(email) {\n  const result = await query(\n    'SELECT * FROM users WHERE email = $1 AND is_active = true',\n    [email]\n  );\n  return result.rows[0] || null;\n}\n\n// Create new user\nexport async function createUser(userData) {\n  const { firstName, lastName, email, password, role, licenseNumber } = userData;\n  \n  const passwordHash = await hashPassword(password);\n  \n  const result = await query(\n    `INSERT INTO users (first_name, last_name, email, password_hash, role, license_number) \n     VALUES ($1, $2, $3, $4, $5, $6) \n     RETURNING id, first_name, last_name, email, role, created_at`,\n    [firstName, lastName, email, passwordHash, role, licenseNumber || null]\n  );\n\n  return result.rows[0];\n}\n\n// Validate user credentials\nexport async function validateUser(email, password) {\n  const user = await getUserByEmail(email);\n  if (!user) {\n    return null;\n  }\n\n  const isValidPassword = await verifyPassword(password, user.password_hash);\n  if (!isValidPassword) {\n    return null;\n  }\n\n  // Return user without password hash\n  const { password_hash, ...userWithoutPassword } = user;\n  return userWithoutPassword;\n}\n","const fs = require('fs')\nconst path = require('path')\nconst os = require('os')\nconst crypto = require('crypto')\nconst packageJson = require('../package.json')\n\nconst version = packageJson.version\n\n// Array of tips to display randomly\nconst TIPS = [\n  'ðŸ” encrypt with Dotenvx: https://dotenvx.com',\n  'ðŸ” prevent committing .env to code: https://dotenvx.com/precommit',\n  'ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild',\n  'ðŸ“¡ observe env with Radar: https://dotenvx.com/radar',\n  'ðŸ“¡ auto-backup env with Radar: https://dotenvx.com/radar',\n  'ðŸ“¡ version env with Radar: https://dotenvx.com/radar',\n  'ðŸ› ï¸  run anywhere with `dotenvx run -- yourcommand`',\n  'âš™ï¸  specify custom .env file path with { path: \\'/custom/path/.env\\' }',\n  'âš™ï¸  enable debug logging with { debug: true }',\n  'âš™ï¸  override existing env vars with { override: true }',\n  'âš™ï¸  suppress all logs with { quiet: true }',\n  'âš™ï¸  write to custom object with { processEnv: myObject }',\n  'âš™ï¸  load multiple .env files with { path: [\\'.env.local\\', \\'.env\\'] }'\n]\n\n// Get a random tip from the tips array\nfunction _getRandomTip () {\n  return TIPS[Math.floor(Math.random() * TIPS.length)]\n}\n\nfunction parseBoolean (value) {\n  if (typeof value === 'string') {\n    return !['false', '0', 'no', 'off', ''].includes(value.toLowerCase())\n  }\n  return Boolean(value)\n}\n\nfunction supportsAnsi () {\n  return process.stdout.isTTY // && process.env.TERM !== 'dumb'\n}\n\nfunction dim (text) {\n  return supportsAnsi() ? `\\x1b[2m${text}\\x1b[0m` : text\n}\n\nconst LINE = /(?:^|^)\\s*(?:export\\s+)?([\\w.-]+)(?:\\s*=\\s*?|:\\s+?)(\\s*'(?:\\\\'|[^'])*'|\\s*\"(?:\\\\\"|[^\"])*\"|\\s*`(?:\\\\`|[^`])*`|[^#\\r\\n]+)?\\s*(?:#.*)?(?:$|$)/mg\n\n// Parse src into an Object\nfunction parse (src) {\n  const obj = {}\n\n  // Convert buffer to string\n  let lines = src.toString()\n\n  // Convert line breaks to same format\n  lines = lines.replace(/\\r\\n?/mg, '\\n')\n\n  let match\n  while ((match = LINE.exec(lines)) != null) {\n    const key = match[1]\n\n    // Default undefined or null to empty string\n    let value = (match[2] || '')\n\n    // Remove whitespace\n    value = value.trim()\n\n    // Check if double quoted\n    const maybeQuote = value[0]\n\n    // Remove surrounding quotes\n    value = value.replace(/^(['\"`])([\\s\\S]*)\\1$/mg, '$2')\n\n    // Expand newlines if double quoted\n    if (maybeQuote === '\"') {\n      value = value.replace(/\\\\n/g, '\\n')\n      value = value.replace(/\\\\r/g, '\\r')\n    }\n\n    // Add to object\n    obj[key] = value\n  }\n\n  return obj\n}\n\nfunction _parseVault (options) {\n  options = options || {}\n\n  const vaultPath = _vaultPath(options)\n  options.path = vaultPath // parse .env.vault\n  const result = DotenvModule.configDotenv(options)\n  if (!result.parsed) {\n    const err = new Error(`MISSING_DATA: Cannot parse ${vaultPath} for an unknown reason`)\n    err.code = 'MISSING_DATA'\n    throw err\n  }\n\n  // handle scenario for comma separated keys - for use with key rotation\n  // example: DOTENV_KEY=\"dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=prod,dotenv://:key_7890@dotenvx.com/vault/.env.vault?environment=prod\"\n  const keys = _dotenvKey(options).split(',')\n  const length = keys.length\n\n  let decrypted\n  for (let i = 0; i < length; i++) {\n    try {\n      // Get full key\n      const key = keys[i].trim()\n\n      // Get instructions for decrypt\n      const attrs = _instructions(result, key)\n\n      // Decrypt\n      decrypted = DotenvModule.decrypt(attrs.ciphertext, attrs.key)\n\n      break\n    } catch (error) {\n      // last key\n      if (i + 1 >= length) {\n        throw error\n      }\n      // try next key\n    }\n  }\n\n  // Parse decrypted .env string\n  return DotenvModule.parse(decrypted)\n}\n\nfunction _warn (message) {\n  console.error(`[dotenv@${version}][WARN] ${message}`)\n}\n\nfunction _debug (message) {\n  console.log(`[dotenv@${version}][DEBUG] ${message}`)\n}\n\nfunction _log (message) {\n  console.log(`[dotenv@${version}] ${message}`)\n}\n\nfunction _dotenvKey (options) {\n  // prioritize developer directly setting options.DOTENV_KEY\n  if (options && options.DOTENV_KEY && options.DOTENV_KEY.length > 0) {\n    return options.DOTENV_KEY\n  }\n\n  // secondary infra already contains a DOTENV_KEY environment variable\n  if (process.env.DOTENV_KEY && process.env.DOTENV_KEY.length > 0) {\n    return process.env.DOTENV_KEY\n  }\n\n  // fallback to empty string\n  return ''\n}\n\nfunction _instructions (result, dotenvKey) {\n  // Parse DOTENV_KEY. Format is a URI\n  let uri\n  try {\n    uri = new URL(dotenvKey)\n  } catch (error) {\n    if (error.code === 'ERR_INVALID_URL') {\n      const err = new Error('INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    }\n\n    throw error\n  }\n\n  // Get decrypt key\n  const key = uri.password\n  if (!key) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing key part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get environment\n  const environment = uri.searchParams.get('environment')\n  if (!environment) {\n    const err = new Error('INVALID_DOTENV_KEY: Missing environment part')\n    err.code = 'INVALID_DOTENV_KEY'\n    throw err\n  }\n\n  // Get ciphertext payload\n  const environmentKey = `DOTENV_VAULT_${environment.toUpperCase()}`\n  const ciphertext = result.parsed[environmentKey] // DOTENV_VAULT_PRODUCTION\n  if (!ciphertext) {\n    const err = new Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${environmentKey} in your .env.vault file.`)\n    err.code = 'NOT_FOUND_DOTENV_ENVIRONMENT'\n    throw err\n  }\n\n  return { ciphertext, key }\n}\n\nfunction _vaultPath (options) {\n  let possibleVaultPath = null\n\n  if (options && options.path && options.path.length > 0) {\n    if (Array.isArray(options.path)) {\n      for (const filepath of options.path) {\n        if (fs.existsSync(filepath)) {\n          possibleVaultPath = filepath.endsWith('.vault') ? filepath : `${filepath}.vault`\n        }\n      }\n    } else {\n      possibleVaultPath = options.path.endsWith('.vault') ? options.path : `${options.path}.vault`\n    }\n  } else {\n    possibleVaultPath = path.resolve(process.cwd(), '.env.vault')\n  }\n\n  if (fs.existsSync(possibleVaultPath)) {\n    return possibleVaultPath\n  }\n\n  return null\n}\n\nfunction _resolveHome (envPath) {\n  return envPath[0] === '~' ? path.join(os.homedir(), envPath.slice(1)) : envPath\n}\n\nfunction _configVault (options) {\n  const debug = parseBoolean(process.env.DOTENV_CONFIG_DEBUG || (options && options.debug))\n  const quiet = parseBoolean(process.env.DOTENV_CONFIG_QUIET || (options && options.quiet))\n\n  if (debug || !quiet) {\n    _log('Loading env from encrypted .env.vault')\n  }\n\n  const parsed = DotenvModule._parseVault(options)\n\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n\n  DotenvModule.populate(processEnv, parsed, options)\n\n  return { parsed }\n}\n\nfunction configDotenv (options) {\n  const dotenvPath = path.resolve(process.cwd(), '.env')\n  let encoding = 'utf8'\n  let processEnv = process.env\n  if (options && options.processEnv != null) {\n    processEnv = options.processEnv\n  }\n  let debug = parseBoolean(processEnv.DOTENV_CONFIG_DEBUG || (options && options.debug))\n  let quiet = parseBoolean(processEnv.DOTENV_CONFIG_QUIET || (options && options.quiet))\n\n  if (options && options.encoding) {\n    encoding = options.encoding\n  } else {\n    if (debug) {\n      _debug('No encoding is specified. UTF-8 is used by default')\n    }\n  }\n\n  let optionPaths = [dotenvPath] // default, look for .env\n  if (options && options.path) {\n    if (!Array.isArray(options.path)) {\n      optionPaths = [_resolveHome(options.path)]\n    } else {\n      optionPaths = [] // reset default\n      for (const filepath of options.path) {\n        optionPaths.push(_resolveHome(filepath))\n      }\n    }\n  }\n\n  // Build the parsed data in a temporary object (because we need to return it).  Once we have the final\n  // parsed data, we will combine it with process.env (or options.processEnv if provided).\n  let lastError\n  const parsedAll = {}\n  for (const path of optionPaths) {\n    try {\n      // Specifying an encoding returns a string instead of a buffer\n      const parsed = DotenvModule.parse(fs.readFileSync(path, { encoding }))\n\n      DotenvModule.populate(parsedAll, parsed, options)\n    } catch (e) {\n      if (debug) {\n        _debug(`Failed to load ${path} ${e.message}`)\n      }\n      lastError = e\n    }\n  }\n\n  const populated = DotenvModule.populate(processEnv, parsedAll, options)\n\n  // handle user settings DOTENV_CONFIG_ options inside .env file(s)\n  debug = parseBoolean(processEnv.DOTENV_CONFIG_DEBUG || debug)\n  quiet = parseBoolean(processEnv.DOTENV_CONFIG_QUIET || quiet)\n\n  if (debug || !quiet) {\n    const keysCount = Object.keys(populated).length\n    const shortPaths = []\n    for (const filePath of optionPaths) {\n      try {\n        const relative = path.relative(process.cwd(), filePath)\n        shortPaths.push(relative)\n      } catch (e) {\n        if (debug) {\n          _debug(`Failed to load ${filePath} ${e.message}`)\n        }\n        lastError = e\n      }\n    }\n\n    _log(`injecting env (${keysCount}) from ${shortPaths.join(',')} ${dim(`-- tip: ${_getRandomTip()}`)}`)\n  }\n\n  if (lastError) {\n    return { parsed: parsedAll, error: lastError }\n  } else {\n    return { parsed: parsedAll }\n  }\n}\n\n// Populates process.env from .env file\nfunction config (options) {\n  // fallback to original dotenv if DOTENV_KEY is not set\n  if (_dotenvKey(options).length === 0) {\n    return DotenvModule.configDotenv(options)\n  }\n\n  const vaultPath = _vaultPath(options)\n\n  // dotenvKey exists but .env.vault file does not exist\n  if (!vaultPath) {\n    _warn(`You set DOTENV_KEY but you are missing a .env.vault file at ${vaultPath}. Did you forget to build it?`)\n\n    return DotenvModule.configDotenv(options)\n  }\n\n  return DotenvModule._configVault(options)\n}\n\nfunction decrypt (encrypted, keyStr) {\n  const key = Buffer.from(keyStr.slice(-64), 'hex')\n  let ciphertext = Buffer.from(encrypted, 'base64')\n\n  const nonce = ciphertext.subarray(0, 12)\n  const authTag = ciphertext.subarray(-16)\n  ciphertext = ciphertext.subarray(12, -16)\n\n  try {\n    const aesgcm = crypto.createDecipheriv('aes-256-gcm', key, nonce)\n    aesgcm.setAuthTag(authTag)\n    return `${aesgcm.update(ciphertext)}${aesgcm.final()}`\n  } catch (error) {\n    const isRange = error instanceof RangeError\n    const invalidKeyLength = error.message === 'Invalid key length'\n    const decryptionFailed = error.message === 'Unsupported state or unable to authenticate data'\n\n    if (isRange || invalidKeyLength) {\n      const err = new Error('INVALID_DOTENV_KEY: It must be 64 characters long (or more)')\n      err.code = 'INVALID_DOTENV_KEY'\n      throw err\n    } else if (decryptionFailed) {\n      const err = new Error('DECRYPTION_FAILED: Please check your DOTENV_KEY')\n      err.code = 'DECRYPTION_FAILED'\n      throw err\n    } else {\n      throw error\n    }\n  }\n}\n\n// Populate process.env with parsed values\nfunction populate (processEnv, parsed, options = {}) {\n  const debug = Boolean(options && options.debug)\n  const override = Boolean(options && options.override)\n  const populated = {}\n\n  if (typeof parsed !== 'object') {\n    const err = new Error('OBJECT_REQUIRED: Please check the processEnv argument being passed to populate')\n    err.code = 'OBJECT_REQUIRED'\n    throw err\n  }\n\n  // Set process.env\n  for (const key of Object.keys(parsed)) {\n    if (Object.prototype.hasOwnProperty.call(processEnv, key)) {\n      if (override === true) {\n        processEnv[key] = parsed[key]\n        populated[key] = parsed[key]\n      }\n\n      if (debug) {\n        if (override === true) {\n          _debug(`\"${key}\" is already defined and WAS overwritten`)\n        } else {\n          _debug(`\"${key}\" is already defined and was NOT overwritten`)\n        }\n      }\n    } else {\n      processEnv[key] = parsed[key]\n      populated[key] = parsed[key]\n    }\n  }\n\n  return populated\n}\n\nconst DotenvModule = {\n  configDotenv,\n  _configVault,\n  _parseVault,\n  config,\n  decrypt,\n  parse,\n  populate\n}\n\nmodule.exports.configDotenv = DotenvModule.configDotenv\nmodule.exports._configVault = DotenvModule._configVault\nmodule.exports._parseVault = DotenvModule._parseVault\nmodule.exports.config = DotenvModule.config\nmodule.exports.decrypt = DotenvModule.decrypt\nmodule.exports.parse = DotenvModule.parse\nmodule.exports.populate = DotenvModule.populate\n\nmodule.exports = DotenvModule\n","import bcrypt from 'bcryptjs';\nimport { query } from './db.js';\n\n// Generate unique username for patient\nexport const generatePatientUsername = async (patientName, patientId) => {\n  // Create base username from patient name\n  const baseName = patientName\n    .toLowerCase()\n    .replace(/[^a-z0-9]/g, '')\n    .substring(0, 8);\n  \n  let username = baseName;\n  let counter = 1;\n  \n  // Check if username exists and make it unique\n  while (true) {\n    const result = await query(\n      'SELECT id FROM patient_users WHERE username = $1',\n      [username]\n    );\n    \n    if (result.rows.length === 0) {\n      break; // Username is unique\n    }\n    \n    username = `${baseName}${counter}`;\n    counter++;\n  }\n  \n  return username;\n};\n\n// Generate secure password\nexport const generatePatientPassword = () => {\n  const length = 12;\n  const charset = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*';\n  let password = '';\n  \n  // Ensure at least one character from each category\n  const lowercase = 'abcdefghijklmnopqrstuvwxyz';\n  const uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n  const numbers = '0123456789';\n  const symbols = '!@#$%^&*';\n  \n  password += lowercase[Math.floor(Math.random() * lowercase.length)];\n  password += uppercase[Math.floor(Math.random() * uppercase.length)];\n  password += numbers[Math.floor(Math.random() * numbers.length)];\n  password += symbols[Math.floor(Math.random() * symbols.length)];\n  \n  // Fill the rest randomly\n  for (let i = 4; i < length; i++) {\n    password += charset[Math.floor(Math.random() * charset.length)];\n  }\n  \n  // Shuffle the password\n  return password.split('').sort(() => Math.random() - 0.5).join('');\n};\n\n// Create patient user account\nexport const createPatientUser = async (patientId, patientName, additionalFields = {}) => {\n  try {\n    // Generate credentials\n    const username = await generatePatientUsername(patientName, patientId);\n    const password = generatePatientPassword();\n    \n    // Hash the password\n    const saltRounds = 12;\n    const passwordHash = await bcrypt.hash(password, saltRounds);\n    \n    // Insert into patient_users table with additional fields\n    const result = await query(\n      `INSERT INTO patient_users (\n        patient_id, username, password_hash, \n        idol, personality, goals, challenges, \n        communication_style, interests, values, support_needs\n      )\n       VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)\n       RETURNING id, username, created_at`,\n      [\n        patientId, \n        username, \n        passwordHash,\n        additionalFields.idol || null,\n        additionalFields.personality || null,\n        additionalFields.goals || null,\n        additionalFields.challenges || null,\n        additionalFields.communicationStyle || null,\n        additionalFields.interests || null,\n        additionalFields.values || null,\n        additionalFields.supportNeeds || null\n      ]\n    );\n    \n    const patientUser = result.rows[0];\n    \n    return {\n      success: true,\n      patientUser: {\n        id: patientUser.id,\n        patientId: patientId,\n        username: username,\n        password: password, // Return plain password for email\n        createdAt: patientUser.created_at,\n        ...additionalFields\n      }\n    };\n  } catch (error) {\n    console.error('Error creating patient user:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n};\n\n// Authenticate patient user\nexport const authenticatePatient = async (username, password) => {\n  try {\n    // Get patient user with patient details and additional fields\n    const result = await query(\n      `SELECT \n        pu.id, pu.patient_id, pu.username, pu.password_hash, pu.is_active,\n        pu.idol, pu.personality, pu.goals, pu.challenges, \n        pu.communication_style, pu.interests, pu.values, pu.support_needs,\n        p.name, p.email, p.diagnosis, p.therapist, p.total_sessions, p.sessions_completed\n       FROM patient_users pu\n       JOIN patients p ON pu.patient_id = p.id\n       WHERE pu.username = $1 AND pu.is_active = true`,\n      [username]\n    );\n    \n    if (result.rows.length === 0) {\n      return { success: false, error: 'Invalid credentials' };\n    }\n    \n    const patientUser = result.rows[0];\n    \n    // Verify password\n    const isValidPassword = await bcrypt.compare(password, patientUser.password_hash);\n    \n    if (!isValidPassword) {\n      return { success: false, error: 'Invalid credentials' };\n    }\n    \n    // Update last login\n    await query(\n      'UPDATE patient_users SET last_login = CURRENT_TIMESTAMP WHERE id = $1',\n      [patientUser.id]\n    );\n    \n    return {\n      success: true,\n      patient: {\n        id: patientUser.patient_id,\n        name: patientUser.name,\n        email: patientUser.email,\n        diagnosis: patientUser.diagnosis,\n        therapist: patientUser.therapist,\n        totalSessions: patientUser.total_sessions,\n        sessionsCompleted: patientUser.sessions_completed\n      },\n      user: {\n        id: patientUser.id,\n        username: patientUser.username,\n        idol: patientUser.idol,\n        personality: patientUser.personality,\n        goals: patientUser.goals,\n        challenges: patientUser.challenges,\n        communicationStyle: patientUser.communication_style,\n        interests: patientUser.interests,\n        values: patientUser.values,\n        supportNeeds: patientUser.support_needs\n      }\n    };\n  } catch (error) {\n    console.error('Error authenticating patient:', error);\n    return {\n      success: false,\n      error: 'Authentication failed'\n    };\n  }\n};\n\n// Get patient user by patient ID\nexport const getPatientUserByPatientId = async (patientId) => {\n  try {\n    const result = await query(\n      `SELECT pu.id, pu.username, pu.is_active, pu.last_login, pu.created_at\n       FROM patient_users pu\n       WHERE pu.patient_id = $1`,\n      [patientId]\n    );\n    \n    if (result.rows.length === 0) {\n      return { success: false, error: 'Patient user not found' };\n    }\n    \n    return {\n      success: true,\n      patientUser: result.rows[0]\n    };\n  } catch (error) {\n    console.error('Error getting patient user:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n};\n\n// Update patient password\nexport const updatePatientPassword = async (patientUserId, newPassword) => {\n  try {\n    const saltRounds = 12;\n    const passwordHash = await bcrypt.hash(newPassword, saltRounds);\n    \n    await query(\n      'UPDATE patient_users SET password_hash = $1, updated_at = CURRENT_TIMESTAMP WHERE id = $2',\n      [passwordHash, patientUserId]\n    );\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Error updating patient password:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n};\n\n// Deactivate patient user\nexport const deactivatePatientUser = async (patientUserId) => {\n  try {\n    await query(\n      'UPDATE patient_users SET is_active = false, updated_at = CURRENT_TIMESTAMP WHERE id = $1',\n      [patientUserId]\n    );\n    \n    return { success: true };\n  } catch (error) {\n    console.error('Error deactivating patient user:', error);\n    return {\n      success: false,\n      error: error.message\n    };\n  }\n};\n","import { NextResponse } from 'next/server';\nimport { query } from '@/lib/db';\nimport { getUserBySession } from '@/lib/auth';\nimport { sendWelcomeEmail, sendPatientCredentialsEmail } from '@/lib/email';\nimport { createPatientUser } from '@/lib/patientAuth';\n\n// GET - Fetch all patients for the authenticated user\nexport async function GET(request) {\n  try {\n    const sessionToken = request.cookies.get('session_token')?.value;\n\n    if (!sessionToken) {\n      return NextResponse.json(\n        { error: 'Not authenticated' },\n        { status: 401 }\n      );\n    }\n\n    const user = await getUserBySession(sessionToken);\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Invalid or expired session' },\n        { status: 401 }\n      );\n    }\n\n    // Get all patients for this user\n    const result = await query(\n      `SELECT * FROM patients \n       WHERE user_id = $1 \n       ORDER BY created_at DESC`,\n      [user.id]\n    );\n\n    return NextResponse.json({\n      patients: result.rows.map(patient => ({\n        id: patient.id,\n        name: patient.name,\n        email: patient.email,\n        phone: patient.phone,\n        dateOfBirth: patient.date_of_birth,\n        diagnosis: patient.diagnosis,\n        medicalHistory: patient.medical_history,\n        emergencyContact: patient.emergency_contact,\n        emergencyPhone: patient.emergency_phone,\n        therapist: patient.therapist,\n        totalSessions: patient.total_sessions,\n        sessionsCompleted: patient.sessions_completed,\n        status: patient.status,\n        notes: patient.notes,\n        createdAt: patient.created_at,\n        updatedAt: patient.updated_at\n      }))\n    });\n\n  } catch (error) {\n    console.error('Get patients error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n\n// POST - Create a new patient\nexport async function POST(request) {\n  try {\n    const sessionToken = request.cookies.get('session_token')?.value;\n\n    if (!sessionToken) {\n      return NextResponse.json(\n        { error: 'Not authenticated' },\n        { status: 401 }\n      );\n    }\n\n    const user = await getUserBySession(sessionToken);\n    if (!user) {\n      return NextResponse.json(\n        { error: 'Invalid or expired session' },\n        { status: 401 }\n      );\n    }\n\n    const body = await request.json();\n    const {\n      name,\n      email,\n      phone,\n      dateOfBirth,\n      diagnosis,\n      medicalHistory,\n      emergencyContact,\n      emergencyPhone,\n      therapist,\n      totalSessions,\n      notes,\n      // New patient profile fields\n      idol,\n      personality,\n      goals,\n      challenges,\n      communicationStyle,\n      interests,\n      values,\n      supportNeeds\n    } = body;\n\n    // Validate required fields\n    if (!name || !diagnosis || !medicalHistory) {\n      return NextResponse.json(\n        { error: 'Name, diagnosis, and medical history are required' },\n        { status: 400 }\n      );\n    }\n\n    // Create new patient\n    const result = await query(\n      `INSERT INTO patients (\n        user_id, name, email, phone, date_of_birth, diagnosis, \n        medical_history, emergency_contact, emergency_phone, \n        therapist, total_sessions, notes\n      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12)\n      RETURNING *`,\n      [\n        user.id,\n        name,\n        email || null,\n        phone || null,\n        dateOfBirth || null,\n        diagnosis,\n        medicalHistory,\n        emergencyContact || null,\n        emergencyPhone || null,\n        therapist || user.first_name + ' ' + user.last_name,\n        totalSessions || 12,\n        notes || null\n      ]\n    );\n\n    const newPatient = result.rows[0];\n\n    // Prepare patient data for email\n    const patientForEmail = {\n      id: newPatient.id,\n      name: newPatient.name,\n      email: newPatient.email,\n      phone: newPatient.phone,\n      dateOfBirth: newPatient.date_of_birth,\n      diagnosis: newPatient.diagnosis,\n      medicalHistory: newPatient.medical_history,\n      emergencyContact: newPatient.emergency_contact,\n      emergencyPhone: newPatient.emergency_phone,\n      therapist: newPatient.therapist,\n      totalSessions: newPatient.total_sessions,\n      sessionsCompleted: newPatient.sessions_completed,\n      status: newPatient.status,\n      notes: newPatient.notes,\n      createdAt: newPatient.created_at,\n      updatedAt: newPatient.updated_at\n    };\n\n    // Create patient user account and send credentials\n    let patientUserResult = null;\n    let credentialsEmailResult = null;\n    let welcomeEmailResult = null;\n\n    if (newPatient.email) {\n      try {\n        // Create patient user account\n        console.log('Creating patient user account...');\n        const additionalFields = {\n          idol: idol || null,\n          personality: personality || null,\n          goals: goals || null,\n          challenges: challenges || null,\n          communicationStyle: communicationStyle || null,\n          interests: interests || null,\n          values: values || null,\n          supportNeeds: supportNeeds || null\n        };\n        patientUserResult = await createPatientUser(newPatient.id, newPatient.name, additionalFields);\n        \n        if (patientUserResult.success) {\n          console.log('Patient user created:', patientUserResult.patientUser.username);\n          \n          // Send credentials email\n          console.log('Sending patient credentials email...');\n          credentialsEmailResult = await sendPatientCredentialsEmail(\n            patientForEmail, \n            {\n              username: patientUserResult.patientUser.username,\n              password: patientUserResult.patientUser.password\n            }\n          );\n          console.log('Credentials email result:', credentialsEmailResult);\n        } else {\n          console.error('Failed to create patient user:', patientUserResult.error);\n        }\n      } catch (error) {\n        console.error('Patient user creation failed (non-blocking):', error);\n        patientUserResult = { success: false, error: error.message };\n      }\n\n      // Also send welcome email\n      try {\n        console.log('Sending welcome email...');\n        welcomeEmailResult = await sendWelcomeEmail(patientForEmail);\n        console.log('Welcome email result:', welcomeEmailResult);\n      } catch (emailError) {\n        console.error('Welcome email sending failed (non-blocking):', emailError);\n        welcomeEmailResult = { success: false, error: emailError.message };\n      }\n    }\n\n    // Prepare response messages\n    const messages = [];\n    if (patientUserResult?.success) {\n      messages.push('Patient user account created');\n    } else if (patientUserResult?.error) {\n      messages.push(`User account creation failed: ${patientUserResult.error}`);\n    }\n    \n    if (credentialsEmailResult?.success) {\n      messages.push('Login credentials sent via email');\n    } else if (credentialsEmailResult?.error) {\n      messages.push(`Credentials email failed: ${credentialsEmailResult.error}`);\n    }\n    \n    if (welcomeEmailResult?.success) {\n      messages.push('Welcome email sent');\n    } else if (welcomeEmailResult?.error) {\n      messages.push(`Welcome email failed: ${welcomeEmailResult.error}`);\n    }\n\n    if (!newPatient.email) {\n      messages.push('No email provided - no user account or emails sent');\n    }\n\n    return NextResponse.json(\n      {\n        message: 'Patient created successfully',\n        patient: patientForEmail,\n        patientUserCreated: patientUserResult?.success || false,\n        credentialsEmailSent: credentialsEmailResult?.success || false,\n        welcomeEmailSent: welcomeEmailResult?.success || false,\n        details: messages.join('; '),\n        hasEmail: !!newPatient.email\n      },\n      { status: 201 }\n    );\n\n  } catch (error) {\n    console.error('Create patient error:', error);\n    return NextResponse.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n","import { AppRouteRouteModule } from \"next/dist/esm/server/route-modules/app-route/module.compiled\";\nimport { RouteKind } from \"next/dist/esm/server/route-kind\";\nimport { patchFetch as _patchFetch } from \"next/dist/esm/server/lib/patch-fetch\";\nimport { getRequestMeta } from \"next/dist/esm/server/request-meta\";\nimport { getTracer, SpanKind } from \"next/dist/esm/server/lib/trace/tracer\";\nimport { normalizeAppPath } from \"next/dist/esm/shared/lib/router/utils/app-paths\";\nimport { NodeNextRequest, NodeNextResponse } from \"next/dist/esm/server/base-http/node\";\nimport { NextRequestAdapter, signalFromNodeResponse } from \"next/dist/esm/server/web/spec-extension/adapters/next-request\";\nimport { BaseServerSpan } from \"next/dist/esm/server/lib/trace/constants\";\nimport { getRevalidateReason } from \"next/dist/esm/server/instrumentation/utils\";\nimport { sendResponse } from \"next/dist/esm/server/send-response\";\nimport { fromNodeOutgoingHttpHeaders, toNodeOutgoingHttpHeaders } from \"next/dist/esm/server/web/utils\";\nimport { getCacheControlHeader } from \"next/dist/esm/server/lib/cache-control\";\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from \"next/dist/esm/lib/constants\";\nimport { NoFallbackError } from \"next/dist/esm/shared/lib/no-fallback-error.external\";\nimport { CachedRouteKind } from \"next/dist/esm/server/response-cache\";\nimport * as userland from \"INNER_APP_ROUTE\";\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new AppRouteRouteModule({\n    definition: {\n        kind: RouteKind.APP_ROUTE,\n        page: \"/api/patients/route\",\n        pathname: \"/api/patients\",\n        filename: \"route\",\n        bundlePath: \"\"\n    },\n    distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n    relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n    resolvedPagePath: \"[project]/src/app/api/patients/route.js\",\n    nextConfigOutput,\n    userland\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return _patchFetch({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\nexport { routeModule, workAsyncStorage, workUnitAsyncStorage, serverHooks, patchFetch,  };\nexport async function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/patients/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (process.env.TURBOPACK) {\n        srcPage = srcPage.replace(/\\/index$/, '') || '/';\n    } else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = process.env.__NEXT_MULTI_ZONE_DRAFT_MODE;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = normalizeAppPath(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = getTracer();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: getRequestMeta(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new NodeNextRequest(req);\n    const nodeNextRes = new NodeNextResponse(res);\n    const nextReq = NextRequestAdapter.fromNodeNextRequest(nodeNextReq, signalFromNodeResponse(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!getRequestMeta(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = toNodeOutgoingHttpHeaders(response.headers);\n                        if (cacheTags) {\n                            headers[NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await sendResponse(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: getRevalidateReason({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!getRequestMeta(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers);\n            if (!(getRequestMeta(req, 'minimalMode') && isIsr)) {\n                headers.delete(NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', getCacheControlHeader(cacheEntry.cacheControl));\n            }\n            await sendResponse(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        // if we aren't wrapped by base-server handle here\n        if (!activeSpan && !(err instanceof NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await sendResponse(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n"],"names":[],"mappings":"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","ignoreList":[1,4]}